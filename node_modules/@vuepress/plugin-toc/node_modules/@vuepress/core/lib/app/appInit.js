"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.appInit = void 0;
const utils_1 = require("@vuepress/utils");
const themeApi_1 = require("../themeApi");
const createAppPages_1 = require("./createAppPages");
const createAppWriteTemp_1 = require("./createAppWriteTemp");
const log = utils_1.debug('vuepress:core/app');
/**
 * Initialize a vuepress app
 *
 * Plugins should be used before initialization.
 */
const appInit = async (app) => {
    log('init start');
    // create write temp util
    app.writeTemp = await createAppWriteTemp_1.createAppWriteTemp(app);
    // create theme api, resolve themes and layouts
    app.themeApi = await themeApi_1.createThemeApi(app);
    // use theme plugin
    if (app.themeApi.parentTheme) {
        app.use(app.themeApi.parentTheme.plugin);
    }
    app.use(app.themeApi.theme.plugin);
    // register all hooks of plugins that have been used
    // plugins should be used before `registerHooks()`
    // hooks in plugins will take effect after `registerHooks()`
    app.pluginApi.registerHooks();
    // plugin hook: extendsMarkdown
    await app.pluginApi.hooks.extendsMarkdown.process(app.markdown, app);
    // create pages
    app.pages = await createAppPages_1.createAppPages(app);
    // plugin hook: onInitialized
    await app.pluginApi.hooks.onInitialized.process(app);
    log('init finish');
};
exports.appInit = appInit;
