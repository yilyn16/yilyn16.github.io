"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createAppPages = void 0;
const utils_1 = require("@vuepress/utils");
const page_1 = require("../page");
const log = utils_1.debug('vuepress:core/app');
/**
 * Create pages for vuepress app
 */
const createAppPages = async (app) => {
    log('createAppPages start');
    // resolve page file paths according to the page patterns
    const pagePaths = await utils_1.globby(app.options.pagePatterns, {
        cwd: app.dir.source(),
    });
    // create pages from files
    const pages = await Promise.all(pagePaths.map(async (filePath) => {
        const pageOptions = { filePath };
        // plugin hook: extendsPageOptions
        const extendsPageOptions = await app.pluginApi.hooks.extendsPageOptions.process(filePath, app);
        extendsPageOptions.forEach((item) => Object.assign(pageOptions, item));
        return page_1.createPage(app, pageOptions);
    }));
    // if there is no 404 page, add one
    if (!pages.some((page) => page.path === '/404.html')) {
        pages.push(await page_1.createPage(app, {
            path: '/404.html',
            frontmatter: {
                layout: '404',
            },
        }));
    }
    log('createAppPages finish');
    return pages;
};
exports.createAppPages = createAppPages;
