<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>yilyn</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9eb234e9.css" as="style"><link rel="preload" href="/assets/js/app.f3273fed.js" as="script"><link rel="preload" href="/assets/js/2.108ee2cf.js" as="script"><link rel="preload" href="/assets/js/31.0dda07c3.js" as="script"><link rel="prefetch" href="/assets/js/10.d3223aca.js"><link rel="prefetch" href="/assets/js/11.9ae80b27.js"><link rel="prefetch" href="/assets/js/12.96666b93.js"><link rel="prefetch" href="/assets/js/13.80dc936c.js"><link rel="prefetch" href="/assets/js/14.3ecc7dc3.js"><link rel="prefetch" href="/assets/js/15.5178e178.js"><link rel="prefetch" href="/assets/js/16.b7641380.js"><link rel="prefetch" href="/assets/js/17.e54bd862.js"><link rel="prefetch" href="/assets/js/18.575d388e.js"><link rel="prefetch" href="/assets/js/19.4e36e40e.js"><link rel="prefetch" href="/assets/js/20.994f8de8.js"><link rel="prefetch" href="/assets/js/21.4a53f650.js"><link rel="prefetch" href="/assets/js/22.eab6d26f.js"><link rel="prefetch" href="/assets/js/23.678c14d0.js"><link rel="prefetch" href="/assets/js/24.7e505f94.js"><link rel="prefetch" href="/assets/js/25.091e1492.js"><link rel="prefetch" href="/assets/js/26.8a07bd0a.js"><link rel="prefetch" href="/assets/js/27.c4f729c8.js"><link rel="prefetch" href="/assets/js/28.5139aeec.js"><link rel="prefetch" href="/assets/js/29.8c911657.js"><link rel="prefetch" href="/assets/js/3.6385512d.js"><link rel="prefetch" href="/assets/js/30.c498e5b3.js"><link rel="prefetch" href="/assets/js/4.061dd861.js"><link rel="prefetch" href="/assets/js/5.48d5b9da.js"><link rel="prefetch" href="/assets/js/6.57e1d6ad.js"><link rel="prefetch" href="/assets/js/7.214c1f60.js"><link rel="prefetch" href="/assets/js/8.3445dd41.js"><link rel="prefetch" href="/assets/js/9.f795dca1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9eb234e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="yilyn" class="logo"> <span class="site-name can-hide">yilyn</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JAVA基础" class="dropdown-title"><span class="title">JAVA基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="JAVA基础" class="mobile-dropdown-title"><span class="title">JAVA基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java_basics/collections/" class="nav-link">
  集合类
</a></li><li class="dropdown-item"><!----> <a href="/java_basics/multi_threads/" class="nav-link">
  多线程
</a></li><li class="dropdown-item"><!----> <a href="/java_basics/JUC/" class="nav-link">
  JUC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/netty/" class="nav-link">
  netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="环境搭建" class="dropdown-title"><span class="title">环境搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="环境搭建" class="mobile-dropdown-title"><span class="title">环境搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/env_build/blog_vuepress/" class="nav-link">
  博客by-vuepress
</a></li><li class="dropdown-item"><!----> <a href="/env_build/docker/" class="nav-link">
  docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/big_data/flink-cdc/" class="nav-link">
  Flink CDC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/databases/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/databases/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="记录" class="dropdown-title"><span class="title">记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="记录" class="mobile-dropdown-title"><span class="title">记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/take_notes/interview/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  面试
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JAVA基础" class="dropdown-title"><span class="title">JAVA基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="JAVA基础" class="mobile-dropdown-title"><span class="title">JAVA基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java_basics/collections/" class="nav-link">
  集合类
</a></li><li class="dropdown-item"><!----> <a href="/java_basics/multi_threads/" class="nav-link">
  多线程
</a></li><li class="dropdown-item"><!----> <a href="/java_basics/JUC/" class="nav-link">
  JUC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络" class="mobile-dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/netty/" class="nav-link">
  netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="环境搭建" class="dropdown-title"><span class="title">环境搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="环境搭建" class="mobile-dropdown-title"><span class="title">环境搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/env_build/blog_vuepress/" class="nav-link">
  博客by-vuepress
</a></li><li class="dropdown-item"><!----> <a href="/env_build/docker/" class="nav-link">
  docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/big_data/flink-cdc/" class="nav-link">
  Flink CDC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/databases/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/databases/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="记录" class="dropdown-title"><span class="title">记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="记录" class="mobile-dropdown-title"><span class="title">记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/take_notes/interview/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  面试
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>记录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/take_notes/interview/" aria-current="page" class="active sidebar-link">面试</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#executors创建线程池的四种方式">Executors创建线程池的四种方式</a></li><li><a href="#为什么不建议用executors创建线程池">为什么不建议用Executors创建线程池</a></li><li><a href="#spring用到的一些设计模式">Spring用到的一些设计模式</a></li><li><a href="#spring-bean-生命周期">spring bean 生命周期</a></li><li><a href="#常用的限流算法">常用的限流算法</a></li><li><a href="#es其中一个数据节点宕机会出现什么问题">ES其中一个数据节点宕机会出现什么问题？</a></li><li><a href="#线程间通信的几种方式">线程间通信的几种方式</a></li><li><a href="#sleep-与-wait-的区别">sleep() 与 wait() 的区别</a></li><li><a href="#运行时数据区">运行时数据区</a></li><li><a href="#java线程的状态">Java线程的状态</a></li><li><a href="#spring解决循环依赖的三级缓存分别是什么">spring解决循环依赖的三级缓存分别是什么</a></li><li><a href="#main-方法的重载、重写">main()方法的重载、重写</a></li><li><a href="#hashmap产生死循环的原因">HashMap产生死循环的原因</a></li><li><a href="#synchronized优化">synchronized优化</a></li><li><a href="#b树和b-树的区别">B树和B+树的区别</a></li><li><a href="#innodb为什么要使用b-树做索引">InnoDB为什么要使用B+树做索引？</a></li><li><a href="#thread真正开启新线程是调用start方法还是run方法">Thread真正开启新线程是调用start方法还是run方法？</a></li></ul></div><p></p> <h3 id="executors创建线程池的四种方式"><a href="#executors创建线程池的四种方式" class="header-anchor">#</a> Executors创建线程池的四种方式</h3> <ol><li>newCachedThreadPool() 可缓存的线程池，coreSize=0，maxCoreSize=Integer.MAX_VALUE, 存活时间60秒，SynchronousQueue队列（没有元素，put时只能等待一个take操作）</li> <li>newFixedThreadPool(int n) 固定长度的线程池，coreSize=maxCoreSize=n,LinkedBlockingQueue</li> <li>newScheduledThreadPool(int n) 可定时执行的线程池 maxCoreSize=Integer.MAX_VALUE，DelayedWorkQueue</li> <li>newSingleThreadExecutor() 单线程的线程池coreSize=maxCoreSize=1</li></ol> <h3 id="为什么不建议用executors创建线程池"><a href="#为什么不建议用executors创建线程池" class="header-anchor">#</a> 为什么不建议用Executors创建线程池</h3> <ol><li>newCachedThreadPool和newScheduledThreadPool创建的线程池，maxCoreSize=Integer.MAX_VALUE，如果阻塞队列任务已满，会不断的创建线程，导致系统个资源被耗尽，严重时会出现OOM</li> <li>newFixedThreadPool和newSingleThreadExecutor这两个方法的阻塞队列是LinkedBlockingQueue，没有限制大小，所以如果使用不当，阻塞队列数量会不断堆积，有出现OOM的风险</li></ol> <h3 id="spring用到的一些设计模式"><a href="#spring用到的一些设计模式" class="header-anchor">#</a> Spring用到的一些设计模式</h3> <ol><li>工厂模式：BeanFactory、ApplicationContext</li> <li>模板方法模式： spring容器初始化时的refresh()方法就用的时模板方法的勾子方法，不同的实现会自行实现内部方法</li> <li>代理模式：AOP使用代理模式，JDK动态代理和Cglib动态代理，JDK动态代理需要被代理类实现接口，Cglib可以代理普通类，JDK是通过反射实现，Cglib是通过字节码生成一个被代理类的子类去进行增强的（所以被代理类不能用final修饰）</li> <li>观察者模式：ApplicationEvent事件监听就是使用了观察者模式</li> <li>适配器模式：springmvc的Controller，spring AOP的通知和增强也用了适配器（AdvisorAdapter）</li> <li>策略模式：不同资源文件的获取</li> <li>单例模式：singleton的bean</li></ol> <h3 id="spring-bean-生命周期"><a href="#spring-bean-生命周期" class="header-anchor">#</a> spring bean 生命周期</h3> <ol><li>实例化bean</li> <li>设置属性</li> <li>检查Aware接口并设置相关依赖（Aware可以理解为获取容器对象的方法）</li> <li>BeanPostProcessor的前置处理（before方法，对bean进行修改）</li> <li>检查是否实现InitializingBean接口，若实现，则调用afterProperties方法对bean进行操作</li> <li>检查是不是有init-method方法，此时调用该方法进行方法的初始化</li> <li>BeanPostProcessor的后置处理</li> <li>注册回调相关的接口</li> <li>使用</li> <li>销毁</li></ol> <h3 id="常用的限流算法"><a href="#常用的限流算法" class="header-anchor">#</a> 常用的限流算法</h3> <ol><li><p>计数器 处理一个请求则+1，请求完成则-1，每次请求时都先判断计数器的值，超过阈值则拒绝。</p> <ul><li>优点：简单粗暴好实现</li> <li>缺点：处理瞬时的高并发请求会对程序有一定压力。</li></ul></li> <li><p>固定窗口 维护一个计数器，将单位时间当作一个窗口，计数器记录这个窗口接收请求的次数。 当请求数小于阈值，则允许访问，并且计数器+1； 当请求数超过阈值，则拒绝访问 当时间窗口结束后，计数器清零</p> <p><strong>问题：</strong></p> <ul><li>当某一时刻瞬时的请求已经将计数器增加到阈值，那么剩下的时间窗口内的请求都会被拒绝，造成一种服务不可用的情况</li> <li>窗口切换前后的请求可能超过阈值</li></ul></li> <li><p>令牌桶算法 令牌桶是漏桶的改进版，可以支持突发流量，桶中存放令牌，而不是流量；恒定定速率往桶中放入令牌，请求过来时如果没有从令牌桶中拿到令牌，则拒绝。</p></li> <li><p>滑动窗口 滑动窗口解决固定窗口临界值的问题，粒度更细；每次请求时如果没有达到阈值，就记录请求的时间，并基于这个时间向后推一个时间窗口。</p> <p><strong>问题：</strong></p> <ul><li>无法解决短时大流量的冲击</li></ul></li> <li><p>漏桶算法 漏桶算法更平滑 漏桶具有固定容量，出口流量速率固定 入口流量速率可以任意（客户端请求量无法控制） 如果入口流量在请求时超过了桶的容量，则拒绝
<strong>问题：</strong></p> <ul><li>因为出口容量是固定的，所以漏桶算法无法解决突发流量的问题</li></ul></li></ol> <h3 id="es其中一个数据节点宕机会出现什么问题"><a href="#es其中一个数据节点宕机会出现什么问题" class="header-anchor">#</a> ES其中一个数据节点宕机会出现什么问题？</h3> <ol><li>其他节点会将宕机节点的主分片副本升级为主分片，所以主分片的数据还是完整的，但是副本不完整，此时集群状态为yellow；</li> <li>一段时间过后（可配置）如果这个宕机的节点还没有恢复并加入到集群中，则ES集群认为它不会回来了，此时会生成缺失的副本，集群状态恢复为green。</li> <li>如果在生成副本数据的时候宕机的节点恢复加入到集群中来了，那么es会比较两个集群的副本，以完整度高的为准。再根据rebalance配置进行rebalance。</li></ol> <h3 id="线程间通信的几种方式"><a href="#线程间通信的几种方式" class="header-anchor">#</a> 线程间通信的几种方式</h3> <ol><li>基于锁（synchronized和retrantlock），不断的去获取锁，线程A和线程B同时执行同一个被锁定的代码块，后抢到锁的需要等待前一个线程执行完成后再执行</li> <li>等待/通知机制，基于Object的wait()方法、nofity()方法、notifyAll()方法</li> <li>join() 方法：join() 方法是Thread类的一个方法，是将当前线程进入【等待】状态，等join的这个线程执行完成后，再执行当前线程</li> <li>sleep() 方法是Thread类的静态方法，作用是让线程睡眠一段时间</li> <li>volitale关键字</li> <li>CountDownLatch 闭锁</li> <li>CyclicBarrier 栅栏</li> <li>Semaphore 信号量</li></ol> <h3 id="sleep-与-wait-的区别"><a href="#sleep-与-wait-的区别" class="header-anchor">#</a> sleep() 与 wait() 的区别</h3> <ol><li>wait方法只能在同步代码块或同步方法中，而sleep方法可以在随意位置</li> <li>两个方法都会释放cpu资源，但是sleep方式不会释放锁，而wait方法会释放</li></ol> <h3 id="运行时数据区"><a href="#运行时数据区" class="header-anchor">#</a> 运行时数据区</h3> <ol><li><p>程序计数器（线程独占）</p> <p>用来存储指向吓一条指令的地址</p></li> <li><p>本地方法栈（线程独占）</p> <p>与虚拟机栈类似，只不过本地方法栈存储的是本地方法（native），Hot Spot虚拟机将本地方法栈和虚拟机栈合二为一。</p></li> <li><p>虚拟机栈（线程独占）</p> <p>每个线程在创建时都会创建一个虚拟机栈，配置参数：-Xss，当分配的栈容量超过配置的大小时，会抛出StackOverFlowError</p></li> <li><p>堆（线程共享）</p> <ul><li>大多数对象都在这里分配内存</li> <li>java7被分为新生代、老年代和永久代；java8被分为新生代、老年代和元空间</li> <li>配置方式： -Xms:堆的起始大小， -Xmx：堆的最大内存，如果堆内存超过最大内存，则会抛出OutOfMemoryError</li> <li>新生代和老年代在堆结构的占比一般为1:2，配置参数：-XX:NewRatio=2或者-Xmn，如果两个配置都存在，以-Xmn为准</li> <li>新生代中Eden和Survivor（2个）所占比例为8:1:1，通过-XX:SurvivorRatio配置</li></ul></li> <li><p>方法区/非堆（线程共享）</p> <p>存储类的结构，方法、构造函数、属性等，还包括常量池，以及类中的一些特殊方法，比如static方法</p></li></ol> <h3 id="java线程的状态"><a href="#java线程的状态" class="header-anchor">#</a> Java线程的状态</h3> <ol><li>NEW 初始化一个线程后，这个线程的状态就是NEW</li> <li>RUNNABLE 当调用线程的start()方法时，该线程状态变为RUNNABLE，可以被cpu进行调度或者是正在调度中</li> <li>BLOCKED 线程拿不到资源锁（synchronized），则处于BLOCKED状态，当获取到锁后，则状态变成RUNNABLE</li> <li>WAITING 调用wait方法之后，状态变为WAITING</li> <li>TIMED_WATING 调用sleep方法时</li> <li>TERMINATED run方法执行完成之后</li></ol> <h3 id="spring解决循环依赖的三级缓存分别是什么"><a href="#spring解决循环依赖的三级缓存分别是什么" class="header-anchor">#</a> spring解决循环依赖的三级缓存分别是什么</h3> <ol><li>private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256); 用来存放完全初始化完成的单例bean</li> <li>private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16); // 二级缓存，用来存放正在创建中的单例bean，此时的bean是初始化完成的，但是并没有对其属性进行注入</li> <li>private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16); // 三级缓存 bean的工厂，用来生成二级缓存中存放的bean的半成品</li></ol> <h3 id="main-方法的重载、重写"><a href="#main-方法的重载、重写" class="header-anchor">#</a> main()方法的重载、重写</h3> <p>main方法<strong>可以被重载</strong>，
<strong>不能被重写</strong>，因为main方法是被static修饰的静态方法，是脱离对象全局唯一的。</p> <h3 id="hashmap产生死循环的原因"><a href="#hashmap产生死循环的原因" class="header-anchor">#</a> HashMap产生死循环的原因</h3> <p>HashMap产生死循环时在JDK7中，JDK7的HashMap是由数组+链表组成的，并且采用头插法的方式为链表添加元素，当多个线程同时执行扩容流程时才会产生死循环的问题。</p> <ol><li>假设当前数组某一位置存在 A-&gt;B-&gt;C 三个节点的链表，此时有T1和T2两个线程对这个HashMap进行扩容，T1和T2线程都指向A节点，T1.next和T2.next都指向B节点；</li> <li>当T1线程先获取到资源，T2线程休眠；T1线程完成扩容后，该数组的这个位置上的链表结构变成了 C-&gt;B-&gt;A(头插法)，这个时候B节点的next指向A，即B.next=A；</li> <li>T1执行完成后，T2获取到CPU资源，这时候就发生了死循环（A和B的next分别指向对方），因为T1执行完成后，B.next=A, 但是T2线程中，还没有发生变化，仍然是A.next=B。</li></ol> <h3 id="synchronized优化"><a href="#synchronized优化" class="header-anchor">#</a> synchronized优化</h3> <p>synchronized在jdk1.5的时候性能比较差，在jdk1.6对其做了优化，包括<strong>锁膨胀（锁升级）</strong>、<strong>锁消除</strong>、<strong>锁粗化</strong>和<strong>自适应自旋锁</strong>。</p> <ol><li>锁膨胀（锁升级）：jdk1.6之前，synchronized是重量级锁，也就是说 synchronized 在释放和获取锁时都会从用户态转换成内核态，所以性能比较差。</li></ol> <p>有了锁膨胀之后，synchronized的状态有了<strong>无锁</strong>、<strong>偏向锁</strong>和<strong>轻量级锁</strong>，这时候在并发操作时大部分场景都不需要用户态到内核态的转换了。</p> <ol start="2"><li>锁消除：JVM如果检测不到某段代码被共享和竞争的可能性，那么会讲这段代码所属的同步锁消除掉。</li></ol> <p>如 StringBuffer 的 append() 方法，内部是synchronized修饰的，在编译之后可能会被编译成StringBuilder对象（不加锁）</p> <ol start="3"><li><p>锁粗化：锁粗化是指，将多个连续的加锁、解锁操作连接在一起，扩展成一个范围更大的锁。</p></li> <li><p>自适应自旋锁（JDK1.7加入）：自旋锁是指通过自身循环，尝试获取锁的一种方式。线程自旋的次数不再是固定的值，而是一个动态改变的值，这个值会根据前一次自旋获取锁的状态来决定此次自旋的次数</p></li></ol> <h3 id="b树和b-树的区别"><a href="#b树和b-树的区别" class="header-anchor">#</a> B树和B+树的区别</h3> <ol><li>B树每个角落节点都保存key和data，B+树的非叶子结点只保存key，叶子结点才保存key和data，</li> <li>B+树的叶子节点通过指针顺序连接，B输没有指针，所以B+树范围查询时效率更高。</li></ol> <h3 id="innodb为什么要使用b-树做索引"><a href="#innodb为什么要使用b-树做索引" class="header-anchor">#</a> InnoDB为什么要使用B+树做索引？</h3> <p>索引要满足高效率的查询，同时在数据的新增和更新过程中维护索引的成本不能太高，B+树比较好的满足了这两点。</p> <p>不用以下数据结构做索引的原因：</p> <ol><li>hash：虽然hash效率很高，但是当出现范围查找的时候，需要对范围内的所有数据都进行hash计算；另外hash不支持key以外字段的等值查询；不适合前缀匹配，因为需要根据计算key的hash才能</li> <li>有序数组：对查询、修改、删除来说数组效率很高，但是当新增数据时，需要插入位置后的所有数据进行位置的移动</li> <li>跳跃表：层级太高导致IO次数变多，影响查询效率</li> <li>B树：中间节点也存储了数据，所以在相同层高下，B树比B+树存储的数据少；另外B树对范围查询不友好，因为叶子节点之间没有使用指针连接。</li></ol> <h3 id="thread真正开启新线程是调用start方法还是run方法"><a href="#thread真正开启新线程是调用start方法还是run方法" class="header-anchor">#</a> Thread真正开启新线程是调用start方法还是run方法？</h3> <ol><li>start方法是Thread类中的方法，用于启动新的线程</li> <li>run方法不会开启线程，而是在start开启新线程之后在这个线程中同步执行的方法。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f3273fed.js" defer></script><script src="/assets/js/2.108ee2cf.js" defer></script><script src="/assets/js/31.0dda07c3.js" defer></script>
  </body>
</html>
